<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mediator Dashboard - ResolveIt</title>

  <!-- Bootstrap + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root {
      --bg-900: #071428;
      --bg-800: #0b2540;
      --teal: #2bb8b8;
      --accent: #f5c76b;
      --glass: rgba(255,255,255,0.06);
      --card: rgba(255,255,255,0.04);
      --muted: #b6c2cc;
      --glass-border: rgba(255,255,255,0.08);
      --shadow: 0 8px 24px rgba(2,8,16,0.45);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }

    body {
      margin: 0;
      background: linear-gradient(180deg, var(--bg-900) 0%, var(--bg-800) 55%);
      color: #e6eef6;
      min-height: 100vh;
    }

    /* NAVBAR */
    .navbar-modern {
      background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      backdrop-filter: blur(6px);
      border-bottom: 1px solid rgba(255,255,255,0.04);
      box-shadow: 0 6px 20px rgba(2,8,16,0.5);
    }
    .navbar .nav-link { color: rgba(230,238,246,0.9); transition: color .15s; }
    .navbar .nav-link:hover { color: var(--accent); }
    .brand-icon {
      background: linear-gradient(135deg, var(--teal), #4fcbd6);
      padding: 6px;
      border-radius: 8px;
      margin-right: 8px;
      display: inline-flex;
      box-shadow: 0 6px 18px rgba(43,184,184,0.14);
    }
    .brand-text {
      font-weight: 700;
      color: #fff;
      letter-spacing: .4px;
    }

    /* HERO */
    .hero {
      padding: 80px 0 50px;
      text-align: center;
      background: url('https://www.centurylawfirm.in/blog/wp-content/uploads/2022/10/mediation-solution.jpg') no-repeat center center/cover;
      position: relative;
    }
    .hero::after {
      content: '';
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.55);
    }
    .hero-content {
      position: relative;
      z-index: 2;
    }
    .hero h1 {
      color: #fff;
      font-weight: 700;
      font-size: 2.4rem;
    }
    .hero p {
      color: #d3e8f0;
      font-size: 1.1rem;
      max-width: 700px;
      margin: 12px auto 0;
    }

    /* STATS CARDS */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      max-width: 1100px;
      margin: -40px auto 40px;
      padding: 0 30px;
      position: relative;
      z-index: 3;
    }
    .stat-card {
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
      text-align: center;
      transition: transform 0.2s;
    }
    .stat-card:hover {
      transform: translateY(-4px);
    }
    .stat-icon {
      width: 48px;
      height: 48px;
      margin: 0 auto 12px;
      background: linear-gradient(135deg, var(--teal), #4fcbd6);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: #fff;
    }
    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 4px;
    }
    .stat-label {
      color: var(--muted);
      font-size: 0.9rem;
    }

    /* SECTIONS */
    .section {
      max-width: 1100px;
      margin: 30px auto;
      padding: 30px;
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
    }
    .section h2 {
      color: #fff;
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .section h2 i {
      color: var(--teal);
    }

    /* PROFILE CARD */
    .profile-card {
      display: flex;
      gap: 24px;
      align-items: start;
      flex-wrap: wrap;
    }
    .profile-img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--teal);
      box-shadow: 0 8px 20px rgba(43,184,184,0.3);
    }
    .profile-details {
      flex: 1;
      min-width: 250px;
    }
    .profile-name {
      font-size: 1.8rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 8px;
    }
    .profile-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-top: 16px;
    }
    .info-item {
      display: flex;
      gap: 8px;
      color: var(--muted);
    }
    .info-item i {
      color: var(--teal);
      margin-top: 2px;
    }
    .badge-verified {
      display: inline-block;
      background: linear-gradient(135deg, #10b981, #059669);
      color: #fff;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    /* CASES TABLE */
    .table-responsive {
      overflow-x: auto;
    }
    .cases-table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }
    .cases-table thead {
      background: rgba(43,184,184,0.1);
    }
    .cases-table th {
      padding: 12px;
      text-align: left;
      color: var(--teal);
      font-weight: 600;
      font-size: 0.9rem;
      border-bottom: 2px solid var(--glass-border);
    }
    .cases-table td {
      padding: 12px;
      border-bottom: 1px solid var(--glass-border);
      color: var(--muted);
    }
    .cases-table tr:hover {
      background: rgba(255,255,255,0.02);
    }
    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }
    .status-open {
      background: rgba(245,199,107,0.2);
      color: var(--accent);
    }
    .status-progress {
      background: rgba(43,184,184,0.2);
      color: var(--teal);
    }
    .status-resolved {
      background: rgba(16,185,129,0.2);
      color: #10b981;
    }

    /* BUTTONS */
    .btn-glass {
      background: linear-gradient(90deg,var(--teal),#4fcbd6);
      color: #021826;
      border: 0;
      font-weight: 700;
      padding: 8px 16px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(43,184,184,0.18);
      cursor: pointer;
      transition: opacity 0.2s;
    }
    .btn-glass:hover {
      opacity: 0.9;
    }
    .btn-danger {
      background: linear-gradient(90deg, #ef4444, #dc2626);
      color: #fff;
    }
    .btn-sm {
      padding: 6px 12px;
      font-size: 0.85rem;
    }

    /* FORM ELEMENTS */
    .form-glass {
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      padding: 10px 14px;
      color: #fff;
      width: 100%;
      margin-bottom: 12px;
    }
    .form-glass:focus {
      outline: none;
      border-color: var(--teal);
      background: rgba(255,255,255,0.08);
    }
    .form-label {
      color: var(--muted);
      font-size: 0.9rem;
      margin-bottom: 6px;
      display: block;
    }
    select.form-glass {
      cursor: pointer;
    }

    /* MEETINGS */
    .meeting-card {
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }
    .meeting-info {
      flex: 1;
      min-width: 200px;
    }
    .meeting-info h4 {
      color: #fff;
      font-size: 1rem;
      margin-bottom: 6px;
    }
    .meeting-info p {
      color: var(--muted);
      font-size: 0.9rem;
      margin: 0;
    }
    .meeting-time {
      color: var(--teal);
      font-weight: 600;
    }
    .meeting-actions {
      display: flex;
      gap: 8px;
    }

    /* EMPTY STATE */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--muted);
    }
    .empty-state i {
      font-size: 3rem;
      color: var(--teal);
      margin-bottom: 16px;
    }

    /* RESPONSIVE */
    @media (max-width: 767px) {
      .stats-container { grid-template-columns: 1fr; }
      .profile-card { flex-direction: column; text-align: center; }
      .profile-img { margin: 0 auto; }
      .cases-table { font-size: 0.85rem; }
      .cases-table th, .cases-table td { padding: 8px; }
      .meeting-card { flex-direction: column; text-align: center; }
    }

    /* MODAL OVERLAY */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .modal-overlay.active {
      display: flex;
    }
    .modal-content {
      background: var(--bg-800);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.6);
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .modal-header h3 {
      color: #fff;
      margin: 0;
    }
    .modal-close {
      background: none;
      border: none;
      color: var(--muted);
      font-size: 1.5rem;
      cursor: pointer;
    }
    .modal-close:hover {
      color: #fff;
    }
  </style>
</head>
<body>

<!-- NAV -->
<nav class="navbar navbar-expand-lg navbar-modern fixed-top">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center" href="/resolve-it-through-mediation">
      <span class="brand-icon">
        <img src="https://img.icons8.com/ios-filled/24/ffffff/scales.png" alt="logo" style="width:18px;height:18px"/>
      </span>
      <span class="brand-text">ResolveIt - Mediator Portal</span>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav align-items-center">
        <li class="nav-item"><a class="nav-link" href="/mediator/dashboard">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" href="/resolve-it-through-mediation">Home</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- HERO -->
<section class="hero">
  <div class="hero-content">
    <h1 th:text="'Welcome, ' + ${mediator.firstName} + ' ' + ${mediator.lastName}">Welcome, Mediator</h1>
    <p>Manage your cases, schedule meetings, and track your progress.</p>
  </div>
</section>

<!-- STATS CARDS -->
<div class="stats-container">
  <div class="stat-card">
    <div class="stat-icon"><i class="bi bi-briefcase-fill"></i></div>
    <div class="stat-value" th:text="${totalCases}">0</div>
    <div class="stat-label">Total Cases</div>
  </div>
  <div class="stat-card">
    <div class="stat-icon"><i class="bi bi-clock-fill"></i></div>
    <div class="stat-value" th:text="${activeCases}">0</div>
    <div class="stat-label">Active Cases</div>
  </div>
  <div class="stat-card">
    <div class="stat-icon"><i class="bi bi-check-circle-fill"></i></div>
    <div class="stat-value" th:text="${resolvedCases}">0</div>
    <div class="stat-label">Resolved Cases</div>
  </div>
  <div class="stat-card">
    <div class="stat-icon"><i class="bi bi-calendar-event-fill"></i></div>
    <div class="stat-value" th:text="${upcomingMeetings}">0</div>
    <div class="stat-label">Upcoming Meetings</div>
  </div>
</div>

<div class="container">

  <!-- PROFILE SECTION -->
  <div class="section">
    <h2><i class="bi bi-person-circle"></i> My Profile</h2>
    <div class="profile-card">
      <img th:src="${mediator.professionalDetails != null && mediator.professionalDetails.imageUrl != null ? mediator.professionalDetails.imageUrl : 'https://static.vecteezy.com/system/resources/thumbnails/020/765/399/small_2x/default-profile-account-unknown-icon-black-silhouette-free-vector.jpg'}"
           alt="Profile" class="profile-img">
      <div class="profile-details">
        <div class="profile-name">
          <span th:text="${mediator.firstName} + ' ' + ${mediator.lastName}">John Doe</span>
          <span class="badge-verified" th:if="${mediator.is_verified}">
            <i class="bi bi-patch-check-fill"></i> Verified
          </span>
        </div>
        <div class="profile-info">
          <div class="info-item">
            <i class="bi bi-envelope-fill"></i>
            <span th:text="${mediator.email}">email@example.com</span>
          </div>
          <div class="info-item">
            <i class="bi bi-telephone-fill"></i>
            <span th:text="${mediator.phone}">9876543210</span>
          </div>
          <div class="info-item">
            <i class="bi bi-gender-ambiguous"></i>
            <span th:text="${mediator.gender}">Gender</span>
          </div>
          <div class="info-item" th:if="${mediator.professionalDetails != null && mediator.professionalDetails.yearsExperience != null}">
            <i class="bi bi-award-fill"></i>
            <span th:text="${mediator.professionalDetails.yearsExperience} + ' years experience'">Experience</span>
          </div>
          <div class="info-item" th:if="${mediator.professionalDetails != null && mediator.professionalDetails.licenseNumber != null}">
            <i class="bi bi-card-heading"></i>
            <span th:text="'License: ' + ${mediator.professionalDetails.licenseNumber}">License</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MY CASES SECTION -->
  <div class="section">
    <h2><i class="bi bi-briefcase"></i> My Cases</h2>

    <div th:if="${cases != null && !cases.isEmpty()}">
      <div class="table-responsive">
        <table class="cases-table">
          <thead>
          <tr>
            <th>Case ID</th>
            <th>Type</th>
            <th>Party 1</th>
            <th>Party 2</th>
            <th>Description</th>
            <th>Status</th>
            <th>Created</th>
            <th>Action</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="case : ${cases}">
            <td th:text="'#' + ${case.case_id}">#1</td>
            <td th:text="${case.case_type}">Type</td>
            <td th:text="${case.party1 != null ? case.party1.name : 'N/A'}">Party 1</td>
            <td th:text="${case.party2 != null ? case.party2.name : 'N/A'}">Party 2</td>
            <td th:text="${case.description}">Description</td>
            <td>
                <span class="status-badge"
                      th:classappend="${case.status == 'Open' ? 'status-open' : (case.status == 'In Progress' ? 'status-progress' : 'status-resolved')}"
                      th:text="${case.status}">Open</span>
            </td>
            <td th:text="${#temporals.format(case.created_at, 'dd MMM yyyy')}">Date</td>
            <td>
              <form th:action="@{/mediator/update-case-status}" method="post" style="display: inline;">
                <input type="hidden" name="caseId" th:value="${case.case_id}">
                <select name="status" class="form-glass" style="width: auto; padding: 6px 10px; margin: 0;" onchange="this.form.submit()">
                  <option value="Open" th:selected="${case.status == 'Open'}">Open</option>
                  <option value="In Progress" th:selected="${case.status == 'In Progress'}">In Progress</option>
                  <option value="Resolved" th:selected="${case.status == 'Resolved'}">Resolved</option>
                </select>
              </form>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div th:if="${cases == null || cases.isEmpty()}" class="empty-state">
      <i class="bi bi-inbox"></i>
      <p>No cases assigned yet</p>
    </div>
  </div>

  <!-- MEETING SCHEDULE SECTION -->
  <div class="section">
    <h2>
      <i class="bi bi-calendar-check"></i> Meeting Schedule
      <button class="btn-glass btn-sm ms-auto" onclick="openMeetingModal()" style="margin-left: auto;">
        <i class="bi bi-plus-circle"></i> Schedule Meeting
      </button>
    </h2>

    <div th:if="${meetings != null && !meetings.isEmpty()}">
      <div th:each="meeting : ${meetings}" class="meeting-card">
        <div class="meeting-info">
          <h4 th:text="${meeting.description}">Meeting Description</h4>
          <p>
            <span class="meeting-time">
              <i class="bi bi-calendar3"></i>
              <span th:text="${#temporals.format(meeting.meetingDate, 'dd MMM yyyy')}">Date</span>
              at
              <span th:text="${#temporals.format(meeting.meetingTime, 'hh:mm a')}">Time</span>
            </span>
          </p>
          <p>
            <span class="status-badge"
                  th:classappend="${meeting.status == 'Scheduled' ? 'status-progress' : (meeting.status == 'Completed' ? 'status-resolved' : 'status-open')}"
                  th:text="${meeting.status}">Status</span>
          </p>
        </div>
        <div class="meeting-actions" th:if="${meeting.status == 'Scheduled'}">
          <a href="https://meet.google.com/cso-zkgk-pfd" class="btn-glass btn-sm">
            <i class="bi bi-camera-video"></i> Start Meeting
          </a>
          <form th:action="@{/mediator/cancel-meeting}" method="post" onsubmit="return confirm('Cancel this meeting?');" style="display: inline;">
            <input type="hidden" name="meetingId" th:value="${meeting.id}">
            <button type="submit" class="btn-danger btn-sm">
              <i class="bi bi-x-circle"></i> Cancel
            </button>
          </form>
        </div>
      </div>
    </div>

    <div th:if="${meetings == null || meetings.isEmpty()}" class="empty-state">
      <i class="bi bi-calendar-x"></i>
      <p>No upcoming meetings scheduled</p>
    </div>
  </div>

</div>

<!-- CREATE MEETING MODAL -->
<div class="modal-overlay" id="meetingModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3><i class="bi bi-calendar-plus"></i> Schedule New Meeting</h3>
      <button class="modal-close" onclick="closeMeetingModal()">&times;</button>
    </div>
    <form th:action="@{/mediator/create-meeting}" method="post">
      <label class="form-label">Select Case</label>
      <select name="caseId" class="form-glass" required>
        <option value="">-- Choose a case --</option>
        <option th:each="case : ${cases}"
                th:value="${case.case_id}"
                th:text="'#' + ${case.case_id} + ' - ' + ${case.case_type} + ' (' + ${case.status} + ')'">
          Case
        </option>
      </select>

      <label class="form-label">Meeting Date</label>
      <input type="date" name="date" class="form-glass" required>

      <label class="form-label">Meeting Time</label>
      <input type="time" name="time" class="form-glass" required>

      <label class="form-label">Description</label>
      <textarea name="description" class="form-glass" rows="3" placeholder="Enter meeting details..." required></textarea>

      <button type="submit" class="btn-glass w-100 mt-3">
        <i class="bi bi-check-circle"></i> Schedule Meeting
      </button>
    </form>
  </div>
</div>

<script>
  function openMeetingModal() {
    document.getElementById('meetingModal').classList.add('active');
  }

  function closeMeetingModal() {
    document.getElementById('meetingModal').classList.remove('active');
  }

  // Close modal when clicking outside
  document.getElementById('meetingModal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeMeetingModal();
    }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>